---
title: 局域网互访虚机
date: 2022-01-08 16:35:20
tags:
- 
categories:
- Linux
---

# 局域网互访虚机

- [宿主机配置](https://yangtzeshore.github.io/2022/01/08/局域网互访虚机/#宿主机配置)
- [虚机配置](https://yangtzeshore.github.io/2022/01/08/局域网互访虚机/#虚机配置)
- [kvm配置](https://yangtzeshore.github.io/2022/01/08/局域网互访虚机/#kvm配置)

## 宿主机配置

找到/etc/network/interfaces，在后面添加

```
auto br0     //添加的桥接网卡，新的名字
iface br0 inet static
address 10.0.1.60    //宿主机IP
netmask 255.255.254.0
broadcast 10.0.1.255
gateway 10.0.0.1
dns-nameservers 114.114.114.114  
bridge_ports enp0s31f6   //宿主机网卡名
bridge_fd 9
```

然后在宿主机

```
sudo ifup br0
```

## 虚机配置

在 **每台** 虚机下配置

/etc/hostname
sysctl kernel.hostname=yourhostname

打开/etc/sysconfig/network-scripts/ifcfg-eth0，依照以下修改，注意：ONBOOT=yes和static。

```
HWADDR=52:54:00:2a:b9:f3
TYPE=Ethernet  
DEFROUTE=yes
IPV4_FAILURE_FATAL=no
IPV6INIT=yes
IPV6_AUTOCONF=yes
IPV6_DEFROUTE=yes
IPV6_FAILURE_FATAL=no
NAME=ens3   //虚机网卡名字
UUID=f9c0608a-3290-4a44-b209-7c25aaa7fec8
DEVICE=ens3  //虚机网卡名字
ONBOOT=yes  //一定yes
DNS1=114.114.114.114  //连外网必备
IPADDR=10.0.0.152   //你要配的虚机网卡IP，0网段
PREFIX=23  //。。
GATEWAY=10.0.0.1  //。。
IPV6_PEERDNS=yes
IPV6_PEERROUTES=yes
```

## kvm配置

打开每台虚机的kvm设置，点击感叹号，点击NIC，找到网络源，选择桥接br0，点击应用确定。然后强制关机再开机（你也可以等待重启）。然后就可以在局域网访问你的虚机了。

```
service network restart
```

## 其他问题

### ubuntu环境设置DNS

在Ubuntu环境下，打开网页非常缓慢，很可能是DNS设置异常的问题。

- 方法1：

  ```
  sudo vi /etc/network/interfaces
  dns-nameservers 114.114.114.114
  ```

- 方法2：

  ```
  sudo vi /etc/resolvconf/resolv.conf/base  
  或者/etc/resolvconf/resolv.conf.d/base
  修改为：
  nameserver 8.8.8.8
  nameserver 8.8.4.4
  然后执行resolvconf -u  
  ```

  就能在/etc/resolv.conf文件中多出2行。
  还有一种方式是修改/etc/resolvconf/resolv.conf/head，不过这个文件系统不建议修改。